<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KDSE Examination Form 2025-26</title>
<style>
body{
    margin:0;
    font-family:'Segoe UI',sans-serif;
    background:linear-gradient(135deg,#e8f5e9,#e3f2fd);
}
.container{
    max-width:900px;
    margin:15px auto;
    background:white;
    padding:15px 20px;
    border-radius:10px;
    border:3px solid #2e7d32;
    box-shadow:0 8px 20px rgba(0,0,0,0.1);
    position:relative;
}
.container::before{
    content:"KALYANI DEVI SCHOOL OF EDUCATION";
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%, -50%) rotate(-30deg);
    font-size:50px;
    color:rgba(0,100,0,0.05);
    font-weight:bold;
    white-space:nowrap;
    pointer-events:none;
}
.header{
    text-align:center;
    border-bottom:2px solid #2e7d32;
    padding-bottom:8px;
}
.school-name{font-size:24px;font-weight:800;color:#1b5e20;}
.address,.contact{font-size:12px;margin-top:3px;}
.udise{font-weight:bold;color:#c62828;margin-top:2px;}
.session{margin-top:5px;font-size:16px;font-weight:bold;color:#0d47a1;}
.form-group{margin-bottom:10px;}
label{font-weight:600;color:#1b5e20;font-size:13px;}
input, textarea, select{
    width:100%;
    padding:5px;
    border:1.5px solid #a5d6a7;
    border-radius:5px;
    margin-top:2px;
    font-size:13px;
}
input:focus,textarea:focus,select:focus{
    border-color:#2e7d32;
    outline:none;
    box-shadow:0 0 3px rgba(46,125,50,0.3);
}
.row{display:flex;gap:10px;}
.row .form-group{flex:1;}
.photo-box{
    width:100px;
    height:120px;
    border:2px solid #2e7d32;
    float:right;
    margin:0 0 10px 10px;
    overflow:hidden;
}
.photo-box img{width:100%;height:100%;object-fit:cover;}
.declaration-box{display:flex;align-items:flex-start;gap:5px;font-size:12px;margin-top:5px;}
.declaration-box input{width:auto;margin-top:4px;}
.signature-section{display:flex;justify-content:space-between;margin-top:20px;font-size:12px;}
.signature{width:30%;text-align:center;font-weight:bold;}
.buttons{text-align:center;margin-top:15px;}
button{
    padding:6px 12px;
    border:none;
    border-radius:5px;
    margin:3px;
    font-size:12.5px;
    cursor:pointer;color:white;
}
.print-btn{background:#2e7d32;display:none;}
.pdf-btn{background:#c62828;display:none;}
.save-btn{background:#6a1b9a;}
.back-btn{background:#1565c0;}
.preview-btn{background:#ff9800;}
@media(max-width:768px){
    .row{flex-direction:column;}
    .photo-box{float:none;margin:auto;display:block;}
    .signature-section{flex-direction:column;gap:15px;}
}
@media print{
    .buttons{display:none;}
    body{background:white;}
}
</style>
</head>
<body>

<div class="container" id="formArea">

<div class="header">
    <div class="school-name">KALYANI DEVI SCHOOL OF EDUCATION</div>
    <div class="address">Kalyani Devi School of Education, Piparkhunta, Post office - Dewarhat, Block - Lormi, Mungeli, Chhattisgarh ‚Äì 495115</div>
    <div class="contact">Mobile: 8224821843 | Email: kdse1227@gmail.com</div>
    <div class="udise">UDISE Code - 22191213904</div>
    <div class="session">Examination Form 2025-26</div>
</div>

<div class="photo-box"><img id="preview"></div>

<form id="examForm">
<div class="row">
<div class="form-group">
<label>Form ID</label>
<input type="text" id="formID" readonly placeholder="Form ID will be generated after Save">
</div>
<div class="form-group">
<label>Class</label>
<select id="classSelect">
<option value="">Select</option>
<option>9</option>
<option>11</option>
</select>
</div>
</div>

<div class="row">
<div class="form-group"><label>Student Name (English)</label><input type="text" id="studentEng"></div>
<div class="form-group"><label>Student Name (Hindi)</label><input type="text" id="studentHin"></div>
</div>

<div class="row">
<div class="form-group"><label>Father Name (English)</label><input type="text" id="fatherEng"></div>
<div class="form-group"><label>Father Name (Hindi)</label><input type="text" id="fatherHin"></div>
</div>

<div class="row">
<div class="form-group"><label>Mother Name (English)</label><input type="text" id="motherEng"></div>
<div class="form-group"><label>Mother Name (Hindi)</label><input type="text" id="motherHin"></div>
</div>

<div class="row">
<div class="form-group"><label>DOB</label><input type="date" id="dob"></div>
<div class="form-group"><label>Gender</label>
<select id="gender"><option value="">Select</option><option>Male</option><option>Female</option><option>Other</option></select>
</div>
</div>

<div class="row">
<div class="form-group"><label>Caste</label><select id="caste"><option value="">Select</option><option>General</option><option>OBC</option><option>SC</option><option>ST</option></select></div>
<div class="form-group"><label>Aadhar</label><input type="text" id="aadhar"></div>
</div>

<div class="row">
<div class="form-group"><label>Mobile</label><input type="text" id="mobile"></div>
<div class="form-group"><label>Email</label><input type="email" id="email"></div>
</div>

<div class="form-group"><label>Address</label><textarea rows="2" id="address"></textarea></div>
<div class="form-group"><label>Upload Photo</label><input type="file" accept="image/*" onchange="previewImage(event)"></div>

<div class="form-group declaration-box">
<input type="checkbox" id="declaration" required>
<span>‡§Æ‡•à‡§Ç ‡§™‡•ç‡§∞‡§Æ‡§æ‡§£‡§ø‡§§ ‡§ï‡§∞‡§§‡§æ/‡§ï‡§∞‡§§‡•Ä ‡§π‡•Ç‡§Å ‡§ï‡§ø ‡§Æ‡•á‡§∞‡•á ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§¶‡•Ä ‡§ó‡§Ø‡•Ä ‡§∏‡§≠‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§∏‡§§‡•ç‡§Ø ‡§π‡•à, ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ï‡•Ä ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Æ‡•ç‡§™‡•Ç‡§∞‡•ç‡§£ ‡§ú‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞‡•Ä ‡§Æ‡•á‡§∞‡•Ä ‡§π‡•ã‡§ó‡•Ä|</span>
</div>
</form>

<div style="text-align:center;margin-top:10px;">
<button class="preview-btn" onclick="showPreview()" id="previewBtn">Preview Form</button>
</div>

<div class="signature-section">
<div class="signature">_____________________<br>Student</div>
<div class="signature">_____________________<br>Incharge</div>
<div class="signature">_____________________<br>Principal</div>
</div>

<div class="buttons">
<button class="print-btn" onclick="window.print()">Print</button>
<button class="pdf-btn" onclick="downloadPDF()">Download PDF</button>
<button class="save-btn" onclick="saveRecord()">Save</button>
<button class="back-btn" onclick="history.back()">Back</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
<script>
let counter = localStorage.getItem("kdseCounter") || 28;
let formID = document.getElementById("formID");

// IMAGE PREVIEW
function previewImage(event){
let reader=new FileReader();
reader.onload=function(){document.getElementById("preview").src=reader.result;}
reader.readAsDataURL(event.target.files[0]);
}

// CHECK REQUIRED
function validateForm(){
return studentEng.value && studentHin.value && fatherEng.value && fatherHin.value && motherEng.value && motherHin.value && dob.value && gender.value && caste.value && aadhar.value && mobile.value && email.value && address.value && classSelect.value && declaration.checked;
}

// SHOW PREVIEW
function showPreview(){
if(!validateForm()){
alert("Please fill all required fields before Preview.");
return;
}
document.getElementById("previewBtn").style.display="none";
document.querySelector(".print-btn").style.display="inline-block";
document.querySelector(".pdf-btn").style.display="inline-block";
}

// DOWNLOAD PDF
function downloadPDF(){
const element=document.getElementById("formArea");
html2pdf().set({
margin:0,
filename:'KDSE_Exam_Form.pdf',
html2canvas:{scale:3},
jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
}).from(element).save();
}

// SAVE RECORD
function saveRecord(){

if(!validateForm()){
alert("Please fill all required fields");
return;
}

// üîí DUPLICATE CHECK USING AADHAR
let savedStudents = JSON.parse(localStorage.getItem("kdseStudents")) || [];

let alreadyExists = savedStudents.find(student => student.aadhar === aadhar.value);

if(alreadyExists){
alert("‚ùå This student has already filled the form.\nDuplicate entry not allowed.");
return;
}

// GENERATE FORM ID
formID.value = "KDSE-2026-" + String(counter).padStart(3,'0');
counter++;
localStorage.setItem("kdseCounter", counter);

// SAVE NEW STUDENT TO LOCAL STORAGE
let formData = {
formID: formID.value,
studentEng: studentEng.value,
fatherEng: fatherEng.value,
motherEng: motherEng.value,
class: classSelect.value,
mobile: mobile.value,
email: email.value,
dob: dob.value,
gender: gender.value,
caste: caste.value,
aadhar: aadhar.value,
address: address.value
};

savedStudents.push(formData);
localStorage.setItem("kdseStudents", JSON.stringify(savedStudents));

// SEND TO GOOGLE SHEET
fetch("https://script.google.com/macros/s/AKfycbxYgfVejlG1x1CZ2HCUfujwPRd6q4trcgPHN4TLyP8c1JxFcSMkmS0Xi4SJV3exzuGGcA/exec",{
method:"POST",
body: JSON.stringify(formData),
headers: {
"Content-Type": "application/json"
}
})
.then(res=>res.text())
.then(data=>{
alert("‚úÖ Record Saved Successfully!");
})
.catch(err=>{
alert("Error Saving Record");
console.log(err);
});

// WHATSAPP MESSAGE
let msg=`KDSE Examination Form Submitted
Form ID: ${formID.value}
Student: ${studentEng.value}
Class: ${classSelect.value}`;

window.open(`https://wa.me/91${mobile.value}?text=${encodeURIComponent(msg)}`,'_blank');

}
</script>

</body>
</html>
